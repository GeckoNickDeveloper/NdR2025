<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sketch Classifier</title>
  <style>
    canvas {
      border: 2px solid black;
      cursor: crosshair;
    }
    #controls {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Draw on the canvas</h2>
  <canvas id="canvas" width="280" height="280"></canvas>
  <div id="controls">
    <button id="clear" onclick="clear()">Clear</button>
  </div>



  <script>
    // Add event listener to clear b tn
    var btn = document.getElementById('clear')
    btn.addEventListener('click', clear)

    // create canvas element and append it to document body
    /*var canvas = document.createElement('canvas');
    document.body.appendChild(canvas);

    // some hotfixes... ( ≖_≖)
    document.body.style.margin = 0;
    canvas.style.position = 'fixed';

    // get canvas 2D context and set him correct size*/
    // TODO: fix offset in drawing
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d');
    resize();

    let send = false

    // last known position
    var pos = { x: 0, y: 0 };

    window.addEventListener('resize', resize);
    document.addEventListener('mousemove', draw);
    document.addEventListener('mousedown', setPosition);
    document.addEventListener('mouseenter', setPosition);

    // new position from mouse event
    function setPosition(e) {
      pos.x = e.clientX;
      pos.y = e.clientY;
    }

    // resize canvas
    function resize() {
      ctx.canvas.width = window.innerWidth;
      ctx.canvas.height = window.innerHeight;
    }

    function draw(e) {
      // mouse left button must be pressed
      if (e.buttons !== 1) return;

      send = true

      ctx.beginPath(); // begin

      ctx.lineWidth = 5;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#1f1f1f';

      ctx.moveTo(pos.x, pos.y); // from
      setPosition(e);
      ctx.lineTo(pos.x, pos.y); // to

      ctx.stroke(); // draw it!

      send = false
    }

    function clear() {
      console.log('clear')
      var canvas = document.getElementById('canvas')
      var ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function sendToServer() {
      const features = preprocessCanvas();

      console.log(features)
      /*const xhr = new XMLHttpRequest();
      xhr.open("POST", "http://127.0.0.1:5000/predict", true);
      xhr.setRequestHeader("Content-Type", "text/plain");

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            const result = JSON.parse(xhr.responseText);
            output.textContent = "Prediction: " + result.prediction;
          } else {
            output.textContent = "Error: " + xhr.status;
          }
        }
      };

      // Send space-separated values
      xhr.send(features.join(" "));*/
    }


    setInterval(() => {
        if (send) {
          var canvas = document.getElementById('canvas')
          var ctx = canvas.getContext('2d');

          img = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

          console.warn(img);
        }
    }, 750)
  </script>
</body>
</html>
